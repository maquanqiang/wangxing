<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.jebao.jebaodb.dao.mapper.employee.TbEmployeeMapper" >
    <resultMap id="BaseResultMap" type="com.jebao.jebaodb.entity.employee.TbEmployee" >
        <id column="emp_id" property="empId" jdbcType="INTEGER" />
        <result column="emp_name" property="empName" jdbcType="VARCHAR" />
        <result column="emp_mobilephone" property="empMobilephone" jdbcType="VARCHAR" />
        <result column="emp_card_no" property="empCardNo" jdbcType="VARCHAR" />
        <result column="emp_sex" property="empSex" jdbcType="INTEGER" />
        <result column="emp_birthday" property="empBirthday" jdbcType="DATE" />
        <result column="emp_status" property="empStatus" jdbcType="INTEGER" />
        <result column="emp_entry_date" property="empEntryDate" jdbcType="DATE" />
        <result column="emp_dimission_date" property="empDimissionDate" jdbcType="DATE" />
        <result column="emp_is_deleted" property="empIsDeleted" jdbcType="BIT" />
        <result column="emp_create_time" property="empCreateTime" jdbcType="TIMESTAMP" />
        <result column="emp_create_user" property="empCreateUser" jdbcType="INTEGER" />
    </resultMap>
    <sql id="Base_Column_List" >
        emp_id, emp_name, emp_mobilephone, emp_card_no, emp_sex, emp_birthday, emp_status,
        emp_entry_date, emp_dimission_date, emp_is_deleted, emp_create_time, emp_create_user
    </sql>
    <select id="selectByPrimaryKey" resultMap="BaseResultMap" parameterType="java.lang.Integer" >
        select
        <include refid="Base_Column_List" />
        from tb_employee
        where emp_id = #{empId,jdbcType=INTEGER}
    </select>
    <insert id="insert" parameterType="com.jebao.jebaodb.entity.employee.TbEmployee" >
        <selectKey resultType="java.lang.Integer" keyProperty="empId" order="AFTER" >
            SELECT LAST_INSERT_ID()
        </selectKey>
        insert into tb_employee (emp_name, emp_mobilephone, emp_card_no,
        emp_sex, emp_birthday, emp_status,
        emp_entry_date, emp_dimission_date, emp_is_deleted,
        emp_create_time, emp_create_user)
        values (#{empName,jdbcType=VARCHAR}, #{empMobilephone,jdbcType=VARCHAR}, #{empCardNo,jdbcType=VARCHAR},
        #{empSex,jdbcType=INTEGER}, #{empBirthday,jdbcType=DATE}, #{empStatus,jdbcType=INTEGER},
        #{empEntryDate,jdbcType=DATE}, #{empDimissionDate,jdbcType=DATE}, #{empIsDeleted,jdbcType=BIT},
        #{empCreateTime,jdbcType=TIMESTAMP}, #{empCreateUser,jdbcType=INTEGER})
    </insert>
    <insert id="insertSelective" parameterType="com.jebao.jebaodb.entity.employee.TbEmployee" >
        <selectKey resultType="java.lang.Integer" keyProperty="empId" order="AFTER" >
            SELECT LAST_INSERT_ID()
        </selectKey>
        insert into tb_employee
        <trim prefix="(" suffix=")" suffixOverrides="," >
            <if test="empName != null" >
                emp_name,
            </if>
            <if test="empMobilephone != null" >
                emp_mobilephone,
            </if>
            <if test="empCardNo != null" >
                emp_card_no,
            </if>
            <if test="empSex != null" >
                emp_sex,
            </if>
            <if test="empBirthday != null" >
                emp_birthday,
            </if>
            <if test="empStatus != null" >
                emp_status,
            </if>
            <if test="empEntryDate != null" >
                emp_entry_date,
            </if>
            <if test="empDimissionDate != null" >
                emp_dimission_date,
            </if>
            <if test="empIsDeleted != null" >
                emp_is_deleted,
            </if>
            <if test="empCreateTime != null" >
                emp_create_time,
            </if>
            <if test="empCreateUser != null" >
                emp_create_user,
            </if>
        </trim>
        <trim prefix="values (" suffix=")" suffixOverrides="," >
            <if test="empName != null" >
                #{empName,jdbcType=VARCHAR},
            </if>
            <if test="empMobilephone != null" >
                #{empMobilephone,jdbcType=VARCHAR},
            </if>
            <if test="empCardNo != null" >
                #{empCardNo,jdbcType=VARCHAR},
            </if>
            <if test="empSex != null" >
                #{empSex,jdbcType=INTEGER},
            </if>
            <if test="empBirthday != null" >
                #{empBirthday,jdbcType=DATE},
            </if>
            <if test="empStatus != null" >
                #{empStatus,jdbcType=INTEGER},
            </if>
            <if test="empEntryDate != null" >
                #{empEntryDate,jdbcType=DATE},
            </if>
            <if test="empDimissionDate != null" >
                #{empDimissionDate,jdbcType=DATE},
            </if>
            <if test="empIsDeleted != null" >
                #{empIsDeleted,jdbcType=BIT},
            </if>
            <if test="empCreateTime != null" >
                #{empCreateTime,jdbcType=TIMESTAMP},
            </if>
            <if test="empCreateUser != null" >
                #{empCreateUser,jdbcType=INTEGER},
            </if>
        </trim>
    </insert>
    <update id="updateByPrimaryKeySelective" parameterType="com.jebao.jebaodb.entity.employee.TbEmployee" >
        update tb_employee
        <set >
            <if test="empName != null" >
                emp_name = #{empName,jdbcType=VARCHAR},
            </if>
            <if test="empMobilephone != null" >
                emp_mobilephone = #{empMobilephone,jdbcType=VARCHAR},
            </if>
            <if test="empCardNo != null" >
                emp_card_no = #{empCardNo,jdbcType=VARCHAR},
            </if>
            <if test="empSex != null" >
                emp_sex = #{empSex,jdbcType=INTEGER},
            </if>
            <if test="empBirthday != null" >
                emp_birthday = #{empBirthday,jdbcType=DATE},
            </if>
            <if test="empStatus != null" >
                emp_status = #{empStatus,jdbcType=INTEGER},
            </if>
            <if test="empEntryDate != null" >
                emp_entry_date = #{empEntryDate,jdbcType=DATE},
            </if>
            <if test="empDimissionDate != null" >
                emp_dimission_date = #{empDimissionDate,jdbcType=DATE},
            </if>
            <if test="empIsDeleted != null" >
                emp_is_deleted = #{empIsDeleted,jdbcType=BIT},
            </if>
            <if test="empCreateTime != null" >
                emp_create_time = #{empCreateTime,jdbcType=TIMESTAMP},
            </if>
            <if test="empCreateUser != null" >
                emp_create_user = #{empCreateUser,jdbcType=INTEGER},
            </if>
        </set>
        where emp_id = #{empId,jdbcType=INTEGER}
    </update>
    <update id="updateByPrimaryKey" parameterType="com.jebao.jebaodb.entity.employee.TbEmployee" >
        update tb_employee
        set emp_name = #{empName,jdbcType=VARCHAR},
        emp_mobilephone = #{empMobilephone,jdbcType=VARCHAR},
        emp_card_no = #{empCardNo,jdbcType=VARCHAR},
        emp_sex = #{empSex,jdbcType=INTEGER},
        emp_birthday = #{empBirthday,jdbcType=DATE},
        emp_status = #{empStatus,jdbcType=INTEGER},
        emp_entry_date = #{empEntryDate,jdbcType=DATE},
        emp_dimission_date = #{empDimissionDate,jdbcType=DATE},
        emp_is_deleted = #{empIsDeleted,jdbcType=BIT},
        emp_create_time = #{empCreateTime,jdbcType=TIMESTAMP},
        emp_create_user = #{empCreateUser,jdbcType=INTEGER}
        where emp_id = #{empId,jdbcType=INTEGER}
    </update>


    <!--==================================================华丽分割线==================================================-->
    <resultMap id="EmployeeResultMap" type="com.jebao.jebaodb.entity.employee.EmployeeInfo">
        <id column="emp_id" property="employee.empId" jdbcType="INTEGER"/>
        <result column="edr_effect_date" property="edrEffectDate" jdbcType="DATE"/>
        <result column="edr_expiry_date" property="edrExpiryDate" jdbcType="DATE"/>
        <result column="err_effect_date" property="errEffectDate" jdbcType="DATE"/>
        <result column="err_expiry_date" property="errExpiryDate" jdbcType="DATE"/>
        <association property="employee" javaType="com.jebao.jebaodb.entity.employee.TbEmployee"
                     resultMap="BaseResultMap"/>
        <association column="dep_id" property="department" javaType="com.jebao.jebaodb.entity.employee.TbDepartment"
                     resultMap="com.jebao.jebaodb.dao.mapper.employee.TbDepartmentMapper.BaseResultMap" />
        <association column="rank_id" property="rank" javaType="com.jebao.jebaodb.entity.employee.TbRank"
                     resultMap="com.jebao.jebaodb.dao.mapper.employee.TbRankMapper.BaseResultMap" />
    </resultMap>

    <select id="selectEmployeeDetailsInfo" resultMap="EmployeeResultMap" parameterType="com.jebao.jebaodb.entity.employee.search.EmployeeSM">
        SELECT * FROM v_employee
        <where>
            <include refid="dynamicJoinWehre"/>
        </where>
        order by emp_id DESC LIMIT #{begin},#{pageSize}
    </select>
    <select id="selectEmployeeDetailsInfoCount" resultType="integer" parameterType="com.jebao.jebaodb.entity.employee.search.EmployeeSM">
        SELECT COUNT(1) FROM v_employee
        <where>
            <include refid="dynamicJoinWehre"/>
        </where>
    </select>
    <sql id="dynamicWehre">
        <if test="empName != null">
            AND emp_name = #{empName,jdbcType=VARCHAR}
        </if>
        <if test="empMobilephone != null">
            AND emp_mobilephone = #{empMobilephone,jdbcType=VARCHAR}
        </if>
        <if test="empCardNo != null">
            AND emp_card_no = #{empCardNo,jdbcType=VARCHAR}
        </if>
        <if test="empSex != null">
            AND emp_sex = #{empSex,jdbcType=TINYINT}
        </if>
        <if test="empBirthday != null">
            AND  emp_birthday = #{empBirthday,jdbcType=DATE}
        </if>
        <if test="empStatus != null">
            AND  emp_status = #{empStatus,jdbcType=INTEGER}
        </if>
        <if test="empEntryDate != null">
            AND  emp_entry_date = #{empEntryDate,jdbcType=DATE}
        </if>
        <if test="empDimissionDate != null">
            AND  emp_dimission_date = #{empDimissionDate,jdbcType=DATE}
        </if>
    </sql>
    <sql id="dynamicJoinWehre">
        <if test="empId != null and empId != ''">
            AND emp_id = #{empId,jdbcType=INTEGER}
        </if>
        <if test="name != null and name != ''">
            AND emp_name = #{name,jdbcType=VARCHAR}
        </if>
        <if test="mobile != null and mobile != ''">
            AND  emp_mobilephone = #{mobile,jdbcType=VARCHAR}
        </if>
        <if test="teamId > 0">
            AND  dep_id = #{teamId,jdbcType=INTEGER}
        </if>
        <if test="rankId > 0">
            AND  rank_id = #{rankId,jdbcType=INTEGER}
        </if>

    </sql>


</mapper>