<!DOCTYPE html>
<html>
<head>#parse("common/head.html")
</head>
<body class="skin-blue sidebar-mini">
#parse("common/main-header.html")
<!-- Left side column. contains the logo and sidebar -->
#parse("common/main-sidebar.html")
<!-- Content Wrapper. Contains page content -->
<div class="content-wrapper">
    <!-- Content Header (Page header) -->
    <section class="content-header">
        <h1>借款人管理</h1>
    </section>
    <!-- Main content -->
    <section class="content" id="content">
        <div class="row">
            <div class="col-xs-12">
                <div class="box box-primary">
                    <form action="" class="form-inline" id="search_form" novalidate="novalidate">
                        <div class="box-body">
                            <div class="form-group">
                                <div class="input-group ">
                                    <div class="input-group-addon">用户名</div>
                                    <input type="text" class="form-control" placeholder="" name="nickName" v-model="searchObj.nickName">
                                </div>
                            </div>
                            <div class="form-group">
                                <div class="input-group ">
                                    <div class="input-group-addon">手机号</div>
                                    <input type="text" class="form-control" placeholder="" name="phone" v-model="searchObj.phone">
                                </div>
                            </div>
                            <div class="form-group">
                                <div class="input-group ">
                                    <div class="input-group-addon">姓名</div>
                                    <input type="text" class="form-control" placeholder="" name="trueName" v-model="searchObj.trueName">
                                </div>
                            </div>
                            <div class="form-group ">
                                <div class="input-group  margin">
                                    <a href="javascript:;" class="btn btn-primary" role="button" id="btnSearch" @click="search">搜索</a>
                                </div>
                            </div>
                            <div class="form-group ">
                                <a href="javascript:;" class="btn btn-primary" role="button" id="add-people">添加借款人</a>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>
        <!--表格内容-->
        <div class="row">
            <div class="col-xs-12">
                <div class="box box-primary">
                    <div class="box-body">
                        <div id="orderlist_table_wrapper" class="dataTables_wrapper">
                            <div class="row">
                                <div class="col-sm-12">
                                    <table id="orderlist_table" class="table table-bordered table-hover dataTable" role="grid" aria-describedby="orderlist_table_info">
                                        <thead>
                                        <tr role="row">
                                            <th width="10%" class="ui-state-default sorting_disabled" rowspan="1" colspan="1">用户名</th>
                                            <th width="10%" class="ui-state-default sorting_disabled" rowspan="1" colspan="1">姓名</th>
                                            <th width="10%" class="ui-state-default sorting_disabled" rowspan="1" colspan="1">手机号</th>
                                            <th width="15%" class="ui-state-default sorting_disabled" rowspan="1" colspan="1">注册时间</th>
                                            <th width="10%" class="ui-state-default sorting_disabled" rowspan="1" colspan="1">实际借款数笔</th>
                                            <th width="10%" class="ui-state-default sorting_disabled" rowspan="1" colspan="1">实际借款金额</th>
                                            <th width="25%" class="ui-state-default sorting_disabled" rowspan="1" colspan="1">操作</th>
                                        </tr>
                                        </thead>
                                        <tbody>
                                        <template v-for="item in loaners">
                                            <tr role="row" class="odd">
                                                <td>{{item.nickName}}</td>
                                                <td>{{item.trueName}}</td>
                                                <td>{{item.phone}}</td>
                                                <td>{{item.registerTime}}</td>
                                                <td>5</td>
                                                <td>10000.00</td>
                                                <td>
                                                    <a href="javascript:;" class="btn btn-default btn-xs btn-modify" role="button" :flag="item.id">修改</a>
                                                    <a :href="getDetailHref(item.id)" class="btn btn-default btn-xs" role="button">查看详情</a>
                                                    <a class="btn btn-default btn-xs" role="button">资金信息</a>
                                                    <a class="btn btn-default btn-xs" role="button">借款信息</a>
                                                    <a :href="getRiskHref(item.id)" class="btn btn-default btn-xs" role="button">风控信息</a>
                                                    <a class="btn btn-default btn-xs remove-msg" role="button" :flag="item.id">删除</a>
                                                </td>
                                            </tr>
                                        </template>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-sm-12 pagination">
                                <div id="pageNum"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>
</div>
<!--提示框-->
<!--添加个人借款用户-->
<div class="modal col-xs-12" id="addInforModal">
    <form class="form-horizontal" action="/api/loaner/addLoaner" method="post">
        <div class="box-body">
            <div class="row form-group">
                <label class="col-sm-4 control-label"><span class="text-red">*</span>注册手机号:</label>
                <div class="col-sm-4">
                    <input id="import-phone" type="text" class="form-control" placeholder="" name="phone">
                </div>
                <div class="col-sm-4">
                    <input id="btnImport" type="button" class="" placeholder="" value="导入用户信息">
                </div>
            </div>
        </div>
        <div class="box-title">
            <h5>基本资料</h5>
        </div>
        <div class="box-body" id="Template-UserInfoView">
            <div class="row form-group">
                <label class="col-sm-2 control-label">用户名</label>
                <div class="col-sm-4">
                    <input type="text" class="form-control" placeholder="" name="nickName" value="" readonly>
                </div>
                <label class="col-sm-2 control-label">真实姓名</label>
                <div class="col-sm-4">
                    <input type="text" class="form-control" placeholder="" name="trueName"  value="" readonly>
                </div>
            </div>
            <div class="row form-group">
                <label class="col-sm-2 control-label">身份证号</label>
                <div class="col-sm-4">
                    <input type="text" class="form-control" placeholder="" name="idNumber" value="" readonly>
                </div>
                <label class="col-sm-2 control-label">性别</label>
                <div class="col-sm-4">
                    <input type="text" class="form-control" placeholder="" name="sex" value="" readonly>
                </div>
            </div>
            <div class="row form-group">
                <label class="col-sm-2 control-label">年龄</label>
                <div class="col-sm-4">
                    <input type="text" class="form-control" placeholder="" name="age" value="" readonly>
                </div>
                <label class="col-sm-2 control-label">邮箱</label>
                <div class="col-sm-4">
                    <input type="text" class="form-control" placeholder="" name="email" value="" readonly>
                </div>
            </div>
        </div>
        <div class="box-title">
            <h5>详细资料</h5>
        </div>
        <div class="box-body">
            <div class="row form-group">
                <label class="col-sm-2 control-label">婚姻状况</label>
                <div class="col-sm-4">
                    <input type="text" class="form-control" placeholder="" name="maritalStatus">
                </div>
                <label class="col-sm-2 control-label">常住地址</label>
                <div class="col-sm-4">
                    <input type="text" class="form-control" placeholder="" name="homeAdd">
                </div>
            </div>

            <div class="row form-group">
                <label class="col-sm-2 control-label">户口所在地</label>
                <div class="col-sm-4">
                    <input type="text" class="form-control" placeholder="" name="hkadr">
                </div>
                <label class="col-sm-2 control-label">政治面貌</label>
                <div class="col-sm-4">
                    <input type="text" class="form-control" placeholder="" name="politicsStatus">
                </div>
            </div>

            <div class="row form-group">
                <label class="col-sm-2 control-label">学历</label>
                <div class="col-sm-4">
                    <input type="text" class="form-control" placeholder="" name="education">
                </div>
                <label class="col-sm-2 control-label">信用状况</label>
                <div class="col-sm-4">
                    <input type="text" class="form-control" placeholder="" name="creditStatus">
                </div>
            </div>
            <div class="row form-group">
                <label class="col-sm-2 control-label">月收入</label>
                <div class="col-sm-4">
                    <input type="text" class="form-control" placeholder="" name="monthlySalary">
                </div>
                <label class="col-sm-2 control-label">工作城市</label>
                <div class="col-sm-4">
                    <input type="text" class="form-control" placeholder="" name="workCity">
                </div>
            </div>
            <div class="row form-group">
                <label class="col-sm-2 control-label">名下是否有房</label>
                <div class="col-sm-4">
                    <input type="text" class="form-control" placeholder="" name="ishaveHouse">
                </div>
                <label class="col-sm-2 control-label">是否有车</label>
                <div class="col-sm-4">
                    <input type="text" class="form-control" placeholder="" name="ishaveCar">
                </div>
            </div>
        </div>
    </form>
</div>
<div id="Template-UserInfo" style="display: none">
    <!---// data-->
    <div class="row form-group">
        <label class="col-sm-2 control-label">用户名</label>
        <div class="col-sm-4">
            <input type="text" class="form-control" placeholder="" name="nickName" value="+-data.nickName-+" readonly>
        </div>
        <label class="col-sm-2 control-label">真实姓名</label>
        <div class="col-sm-4">
            <input type="text" class="form-control" placeholder="" name="trueName"  value="+-data.trueName-+" readonly>
        </div>
    </div>
    <div class="row form-group">
        <label class="col-sm-2 control-label">身份证号</label>
        <div class="col-sm-4">
            <input type="text" class="form-control" placeholder="" name="idNumber" value="+-data.idNumber-+" readonly>
        </div>
        <label class="col-sm-2 control-label">性别</label>
        <div class="col-sm-4">
            <input type="text" class="form-control" placeholder="" name="sex" value="+-data.sex-+" readonly>
        </div>
    </div>
    <div class="row form-group">
        <label class="col-sm-2 control-label">年龄</label>
        <div class="col-sm-4">
            <input type="text" class="form-control" placeholder="" name="age" value="+-data.age-+" readonly>
        </div>
        <label class="col-sm-2 control-label">邮箱</label>
        <div class="col-sm-4">
            <input type="text" class="form-control" placeholder="" name="email" value="+-data.email-+" readonly>
        </div>
    </div>
</div>
<!--修改个人借款用户-->
<div class="modal col-xs-12" id="modInforInfModal">
    <form class="form-horizontal" action="/api/loaner/modifyLoaner" method="post">
        <div class="box-title">
            <h5>基本资料</h5>
        </div>
        <div class="box-body" id="Template-Modify-InfoView">
            <div class="row form-group">
                <input type="hidden" name="id" value="">
                <label class="col-sm-2 control-label">手机号</label>
                <div class="col-sm-4">
                    <input type="text" class="form-control" placeholder="" name="phone" value="" readonly>
                </div>
                <label class="col-sm-2 control-label">角色</label>
                <div class="col-sm-4">
                    <input type="text" class="form-control" placeholder="" value="借款人" readonly>
                </div>
            </div>
            <div class="row form-group">
                <label class="col-sm-2 control-label">用户名</label>
                <div class="col-sm-4">
                    <input type="text" class="form-control" placeholder="" name="nickName" value="" readonly>
                </div>
                <label class="col-sm-2 control-label">真实姓名</label>
                <div class="col-sm-4">
                    <input type="text" class="form-control" placeholder="" name="trueName" value="" readonly>
                </div>
            </div>
            <div class="row form-group">
                <label class="col-sm-2 control-label">身份证号</label>
                <div class="col-sm-4">
                    <input type="text" class="form-control" placeholder=""  name="idNumber" value="" readonly>
                </div>
                <label class="col-sm-2 control-label">性别</label>
                <div class="col-sm-4">
                    <input type="text" class="form-control" placeholder="" name="sex" value="" readonly>
                </div>
            </div>
            <div class="row form-group">
                <label class="col-sm-2 control-label">年龄</label>
                <div class="col-sm-4">
                    <input type="text" class="form-control" placeholder="" name="age" value="" readonly>
                </div>
                <label class="col-sm-2 control-label">邮箱</label>
                <div class="col-sm-4">
                    <input type="text" class="form-control" placeholder="" name="email" value="" readonly>
                </div>
            </div>
            <div class="row form-group">
                <label class="col-sm-2 control-label">注册时间</label>
                <div class="col-sm-4">
                    <input type="text" class="form-control" placeholder="" name="registerTime" value="" readonly>
                </div>
                <label class="col-sm-2 control-label">最后一次登录</label>
                <div class="col-sm-4">
                    <input type="text" class="form-control" placeholder="" name="lastLoginTime" value="" readonly>
                </div>
            </div>
        </div>
        <div class="box-title">
            <h5>详细资料</h5>
        </div>
        <div class="box-body" id="Template-Modify-DetailsView">
            <div class="row form-group">
                <label class="col-sm-2 control-label">婚姻状况</label>
                <div class="col-sm-4">
                    <input type="text" class="form-control" placeholder="" name="maritalStatus">
                </div>
                <label class="col-sm-2 control-label">常住地址</label>
                <div class="col-sm-4">
                    <input type="text" class="form-control" placeholder="" name="homeAdd">
                </div>
            </div>
            <div class="row form-group">
                <label class="col-sm-2 control-label">户口所在地</label>
                <div class="col-sm-4">
                    <input type="text" class="form-control" placeholder="" name="hkadr">
                </div>
                <label class="col-sm-2 control-label">政治面貌</label>
                <div class="col-sm-4">
                    <input type="text" class="form-control" placeholder="" name="politicsStatus">
                </div>
            </div>
            <div class="row form-group">
                <label class="col-sm-2 control-label">学历</label>
                <div class="col-sm-4">
                    <input type="text" class="form-control" placeholder="" name="education">
                </div>
                <label class="col-sm-2 control-label">信用状况</label>
                <div class="col-sm-4">
                    <input type="text" class="form-control" placeholder="" name="creditStatus">
                </div>
            </div>

            <div class="row form-group">
                <label class="col-sm-2 control-label">月收入</label>
                <div class="col-sm-4">
                    <input type="text" class="form-control" placeholder="" name="monthlySalary">
                </div>
                <label class="col-sm-2 control-label">工作城市</label>
                <div class="col-sm-4">
                    <input type="text" class="form-control" placeholder="" name="workCity">
                </div>
            </div>
            <div class="row form-group">
                <label class="col-sm-2 control-label">名下是否有房</label>
                <div class="col-sm-4">
                    <input type="text" class="form-control" placeholder="" name="ishaveHouse">
                </div>
                <label class="col-sm-2 control-label">是否有车</label>
                <div class="col-sm-4">
                    <input type="text" class="form-control" placeholder="" name="ishaveCar">
                </div>
            </div>
        </div>
    </form>
</div>
<div id="Template-Modify-Info" style="display: none;">
    <!---// data-->
    <div class="row form-group">
        <input type="hidden" name="id" value="+-data.id-+">
        <label class="col-sm-2 control-label">手机号</label>
        <div class="col-sm-4">
            <input type="text" class="form-control" placeholder="" name="phone" value="+-data.phone-+" readonly>
        </div>
        <label class="col-sm-2 control-label">角色</label>
        <div class="col-sm-4">
            <input type="text" class="form-control" placeholder="" value="借款人" readonly>
        </div>
    </div>
    <div class="row form-group">
        <label class="col-sm-2 control-label">用户名</label>
        <div class="col-sm-4">
            <input type="text" class="form-control" placeholder="" name="nickName" value="+-data.nickName-+" readonly>
        </div>
        <label class="col-sm-2 control-label">真实姓名</label>
        <div class="col-sm-4">
            <input type="text" class="form-control" placeholder="" name="trueName" value="+-data.trueName-+" readonly>
        </div>
    </div>
    <div class="row form-group">
        <label class="col-sm-2 control-label">身份证号</label>
        <div class="col-sm-4">
            <input type="text" class="form-control" placeholder=""  name="idNumber" value="+-data.idNumber-+" readonly>
        </div>
        <label class="col-sm-2 control-label">性别</label>
        <div class="col-sm-4">
            <input type="text" class="form-control" placeholder="" name="sex" value="+-data.sex-+" readonly>
        </div>
    </div>
    <div class="row form-group">
        <label class="col-sm-2 control-label">年龄</label>
        <div class="col-sm-4">
            <input type="text" class="form-control" placeholder="" name="age" value="+-data.age-+" readonly>
        </div>
        <label class="col-sm-2 control-label">邮箱</label>
        <div class="col-sm-4">
            <input type="text" class="form-control" placeholder="" name="email" value="+-data.email-+" readonly>
        </div>
    </div>
    <div class="row form-group">
        <label class="col-sm-2 control-label">注册时间</label>
        <div class="col-sm-4">
            <input type="text" class="form-control" placeholder="" name="registerTime" value="+-data.registerTime-+" readonly>
        </div>
        <label class="col-sm-2 control-label">最后一次登录</label>
        <div class="col-sm-4">
            <input type="text" class="form-control" placeholder="" name="lastLoginTime" value="+-data.lastLoginTime-+" readonly>
        </div>
    </div>
</div>
<div id="Template-Modify-Details" style="display: none;">
    <!---// data-->
    <div class="row form-group">
        <label class="col-sm-2 control-label">婚姻状况</label>
        <div class="col-sm-4">
            <input type="text" class="form-control" placeholder="" name="maritalStatus" value="+-data.maritalStatus-+">
        </div>
        <label class="col-sm-2 control-label">常住地址</label>
        <div class="col-sm-4">
            <input type="text" class="form-control" placeholder="" name="homeAdd" value="+-data.homeAdd-+">
        </div>
    </div>
    <div class="row form-group">
        <label class="col-sm-2 control-label">户口所在地</label>
        <div class="col-sm-4">
            <input type="text" class="form-control" placeholder="" name="hkadr" value="+-data.hkadr-+">
        </div>
        <label class="col-sm-2 control-label">政治面貌</label>
        <div class="col-sm-4">
            <input type="text" class="form-control" placeholder="" name="politicsStatus" value="+-data.politicsStatus-+">
        </div>
    </div>
    <div class="row form-group">
        <label class="col-sm-2 control-label">学历</label>
        <div class="col-sm-4">
            <input type="text" class="form-control" placeholder="" name="education" value="+-data.education-+">
        </div>
        <label class="col-sm-2 control-label">信用状况</label>
        <div class="col-sm-4">
            <input type="text" class="form-control" placeholder="" name="creditStatus" value="+-data.creditStatus-+">
        </div>
    </div>

    <div class="row form-group">
        <label class="col-sm-2 control-label">月收入</label>
        <div class="col-sm-4">
            <input type="text" class="form-control" placeholder="" name="monthlySalary" value="+-data.monthlySalary-+">
        </div>
        <label class="col-sm-2 control-label">工作城市</label>
        <div class="col-sm-4">
            <input type="text" class="form-control" placeholder="" name="workCity" value="+-data.workCity-+">
        </div>
    </div>
    <div class="row form-group">
        <label class="col-sm-2 control-label">名下是否有房</label>
        <div class="col-sm-4">
            <input type="text" class="form-control" placeholder="" name="ishaveHouse" value="+-data.ishaveHouse-+">
        </div>
        <label class="col-sm-2 control-label">是否有车</label>
        <div class="col-sm-4">
            <input type="text" class="form-control" placeholder="" name="ishaveCar" value="+-data.ishaveCar-+">
        </div>
    </div>
</div>
<!-- /.content-wrapper -->
#parse("common/footer.html")
<script>
    $(function(){
        //添加人借款用户信息
        $('#add-people').on('click',function(){
            var tempObj= $('#addInforModal').clone();
            tempObj.find('form').attr('id','insertFormId');
            var tempHtml=tempObj.html();
            layer.open({
                title:'添加个人借款用户',
                content:tempHtml,
                btn: ['添加', '重置'],
                area:['800px'],
                btn1: function(){
                    //initValidateForm($('#insertFormId'));
                    //var bootstrapValidator = $("#insertFormId").data('bootstrapValidator').validate();
                    //if(!bootstrapValidator.isValid()){
                    var phone= $('#insertFormId #import-phone').val();
                    if(phone.trim().length < 11){
                        return false;
                    }else{
                        //TODO 后台逻辑
                        $.axForForm($('#insertFormId'),function(data){
                            if(data.success_is_ok)
                            {
                                layer.alert('添加成功！',function(){
                                    layer.closeAll();
                                });
                                var targetUrl="/loaner/index";
                                redirectUrl(targetUrl);
                                return;
                            }else{
                                layer.alert(data.msg,function(){
                                    layer.closeAll();
                                });
                            }
                        });

                    }
                },
                btn2: function(){
                    $("#insertFormId input[type=text]").val("");
                    return false;
                }
            });
            $('#insertFormId #btnImport').on('click',function(){
                var phone= $('#insertFormId #import-phone').val();
               // alert("phone="+phone);
                $.get("/api/loaner/importLoaner","phone="+phone,function(response){
                    if (response.success_is_ok){
                        if (response.data != null){var model=response.data;
                           // alert(model.nickName);
                           var html= dataToHtml('#Template-UserInfo', model);
                          //  alert("导入数据成功"+html);
                            $('#insertFormId #Template-UserInfoView').html(html);
                        }
                    }
                });
            });
        });
        //删除信息
        $('#orderlist_table').on('click','.remove-msg',function(){
            var loanerId = $(this).attr("flag");
            layer.open({
                content:'您是否删除信息?',
                btn: ['取消', '删除'],
                yes: function(){
                    layer.closeAll();
                },
                btn2: function(){
/*                    $(this).parent().parent().remove();
                    layer.msg('删除成功！', {icon: 1});*/
                    $.get("/api/loaner/deleteLoaner","id="+loanerId,function(response){
                        if (response.success_is_ok){
                            layer.msg('删除成功！', {icon: 1});
                            var targetUrl="/loaner/index";
                            redirectUrl(targetUrl);
                            return;
                        }else{
                            layer.msg('删除失败！', {icon: 1});
                        }
                    });
                }
            });
        });
        //修改借款用户信息
        $('#orderlist_table').on('click','.btn-modify',function(){
            var tempObj= $('#modInforInfModal').clone();
            tempObj.find('form').attr('id','ModifyFormId');
            var tempHtml=tempObj.html();
            layer.open({
                title:'修改个人借款用户',
                content:tempHtml,
                area:['800px'],
                btn: ['保存', '取消'],
                btn1: function(){
                    //TODO 后台逻辑
                    $.axForForm($('#ModifyFormId'),function(data){
                        if(data.success_is_ok)
                        {
                            layer.alert('修改成功！',function(){
                                layer.closeAll();
                            });
                        }else{
                            layer.alert(data.msg,function(){
                                layer.closeAll();
                            });
                        }
                    });
                },
                btn2: function(){
                    layer.close();
                }
            });
            /*加载借款人*/
            var loanerId = $(this).attr("flag");
            $.get("/api/loaner/details","loanerId="+loanerId,function(response){
                if (response.success_is_ok){
                    if (response.data != null){var model=response.data;
                        var html= dataToHtml('#Template-Modify-Info', model);
                        $('#ModifyFormId #Template-Modify-InfoView').html(html);

                        var dhtml= dataToHtml('#Template-Modify-Details', model);
                        $('#ModifyFormId #Template-Modify-DetailsView').html(dhtml);
                    }
                }
            });
        });
    });
</script>
<script src=$UrlHelperTool.href("/content/script/loaner/index.js")></script>
</body>
</html>
